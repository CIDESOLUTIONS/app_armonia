enum PanicStatus {
  ACTIVE
  RESOLVED
  FALSE_ALARM
  CANCELLED

  @@schema("tenant")
}

enum PanicType {
  MEDICAL
  SECURITY
  FIRE
  OTHER

  @@schema("tenant")
}

model PanicAlert {
  id          Int         @id @default(autoincrement())
  userId      Int
  user        User        @relation(fields: [userId], references: [id])
  complexId   Int
  complex     ResidentialComplex @relation(fields: [complexId], references: [id])
  propertyId  Int?
  property    Property?   @relation(fields: [propertyId], references: [id])
  type        PanicType
  status      PanicStatus @default(ACTIVE)
  location    String?     // GPS coordinates or description
  description String?
  alertTime   DateTime    @default(now())
  resolvedTime DateTime?
  resolvedBy  User?       @relation("ResolvedPanicAlerts", fields: [resolvedById], references: [id])
  resolvedById Int?
  responses   PanicResponse[]

  @@index([userId])
  @@index([complexId])
  @@index([propertyId])
  @@index([status])
  @@index([alertTime])
  @@schema("tenant")
}

model PanicResponse {
  id          Int      @id @default(autoincrement())
  alertId     Int
  alert       PanicAlert @relation(fields: [alertId], references: [id])
  respondedBy Int
  responder   User     @relation("PanicResponses", fields: [respondedBy], references: [id])
  responseTime DateTime @default(now())
  actionTaken String
  notes       String?

  @@index([alertId])
  @@index([respondedBy])
  @@schema("tenant")
}
